**Описание работы схемы, устраняющей эффект debounce у кнопки.**

Первоначально, в схеме установлена цепь из последовательных D-триггеров, она представлена в листинге 1. Она содержит 2 ячейки. Данная схема необходима для устранения метастабильности, которая может возникнуть из-за несоответствия частоты нажатия кнопки и частоты тактового генератора на 50 МГц.

Листинг 1 – Схема для устранения метастабильности

always @(posedge CLK)

begin

r_sync \[ 0 \] <= IN;

r_sync \[ 1 \] <= r_sync \[ 0 \];

end

Затем входные данные проходят через D-триггер и возникают старые данные (после прохождения через D-триггер) и новые (до прохождения через D-триггер). Они представлены в листинге 2.

Листинг 2 – Старые и новые данные

always @(posedge CLK)

r_old_data <= w_new_data;

Для корректной работы схемы вводится флаг, необходимый для запуска работы счётчика (или таймера) и определения состояния: происходит переход между уровнями сигнала или сохраняется одно состояние. Код флага представлен в листинге 3. Для работы флага и определения перехода вводится переменная w_en_flag, использующая тернарный оператор.

Листинг 3 – Код флага

assign w_en_flag = ((r_old_data == 1'b1 & w_new_data == 1'b0) | (r_old_data == 1'b0 & w_new_data == 1'b1)) ? 1'b1 : 1'b0;

always @(posedge CLK)

if(w_en_flag & r_count\[20\])

r_flag <= 1'b1;

else if(r_flag)

r_flag <= 1'b0;

Для корректной передачи сигнала необходимо 10 мс, которые можно обеспечить с помощью счётчика (или таймера). Счётчик представлен в листинге 4. При значении флага равного 1 происходит сброс счётчика и передача новых данных на выход. Иначе из счётчика вычитается 1.

Если уровень сигнала не изменяется и находится в одном состоянии, на выход идут новые данные.

Листинг 4 – Код счётчика

always @(posedge CLK)

begin

if(r_flag) begin

r_count <= 21'd499999;

OUT <= w_new_data;

end

else begin

if(~r_count\[ 20 \])

r_count <= r_count - 1'd1;

else OUT <= w_new_data;

end

end

<img width="1883" height="857" alt="time_tables" src="https://github.com/user-attachments/assets/ac4dc8c3-49f8-41dd-9294-47653a71f8e3" />
